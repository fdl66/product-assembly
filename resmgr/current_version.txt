DESCRIPTION  Persist current version number of RM
REQUIRE_SVC

# Choose image to work on
SVC_USE zenoss/resmgr_REPLACE_1

# Start all dependent services
SVC_START Zenoss.resmgr/Infrastructure/mariadb-model
SVC_START Zenoss.resmgr/Infrastructure/mariadb-events
SVC_START Zenoss.resmgr/Infrastructure/RabbitMQ
SVC_START Zenoss.resmgr/Zenoss/Events/zeneventserver
SVC_START Zenoss.resmgr/Infrastructure/redis

# Wait for services to start
SVC_WAIT Zenoss.resmgr/Infrastructure/mariadb-model Zenoss.resmgr/Infrastructure/mariadb-events Zenoss.resmgr/Infrastructure/RabbitMQ Zenoss.resmgr/Zenoss/Events/zeneventserver Zenoss.resmgr/Infrastructure/redis started 1200

# Write current version to file
SVC_EXEC NO_COMMIT "Zenoss.resmgr/Zenoss/User Interface/Zope" sh -c "echo %FROM_VERSION% > /var/zenoss/upgrade_from_version.txt && chown zenoss:zenoss /var/zenoss/upgrade_from_version.txt"

